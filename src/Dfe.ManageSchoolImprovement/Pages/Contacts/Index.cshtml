@page "/contacts/{id:int}"

@using Dfe.ManageSchoolImprovement.Domain.ValueObjects
@using Dfe.ManageSchoolImprovement.Utils
@model IndexModel
@{
    ViewData["Title"] = "Contact";
    TempData["AssignmentReferrer"] = @Links.Contacts.Index.Page;
}

@section BeforeMain
{
    <nav aria-label="back navigation">
        <a asp-page="@Model.ReturnPage" class="govuk-back-link">@Links.SchoolList.Index.BackText</a>
    </nav>
}

<partial name="_ProjectHeader" model="Model.SupportProject"/>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <h2 class="govuk-heading-l">Contacts</h2>
        <div class="govuk-!-margin-top-5">
            <a asp-page="@Links.Contacts.AddContactOrganisation.Page" asp-route-id="@Model.SupportProject.Id" role="button"
               draggable="false" class="govuk-button" data-module="govuk-button">
                Add contact
            </a>
        </div>
    </div>
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
            <h3 class="govuk-heading-m">School contacts</h3>
            <div class="govuk-inset-text govuk-!-margin-top-0">
                <p class="govuk-body">
                    @(!string.IsNullOrEmpty(Model.SchoolAddress) ? Html.Raw(Model.SchoolAddress.Replace(",", "<br>")) : "Not available")
                </p>
            </div>
            @if (Model.SupportProject.HeadteacherName != null)
            {
                <partial name="_ContactCard"
                         model='@Model.Headteacher'/>
            }
            @if (Model.ChairOfGovernors != null)
            {
                <partial name="_ContactCard"
                         model='@Model.ChairOfGovernors'/>
            }
            @if (Model.AccountingOfficer != null)
            {
                <partial name="_ContactCard"
                         model='@Model.AccountingOfficer'/>
            }
            
            @if (Model.OtherSchoolContacts?.Any() == true)
            {
                foreach (var contact in Model.OtherSchoolContacts)
                {
                    <partial name="_ContactCard"
                             model='@contact'/>
                }
            }
        </div>

        @if (!string.IsNullOrEmpty(Model.SupportingOrganisationAccountingOfficer?.Name) || !string.IsNullOrEmpty(Model.SupportingOrganisationHeadteacher?.Name))
        {
            <div class="govuk-grid-column-three-quarters">
                <h3 class="govuk-heading-m">Supporting organisation contacts</h3>
                <div class="govuk-inset-text govuk-!-margin-top-0">
                    <p class="govuk-body">
                        @(!string.IsNullOrEmpty(Model.SupportingOrganisationAddress) ? Html.Raw(Model.SupportingOrganisationAddress.Replace(",", "<br>")) : "Not available")
                    </p>
                </div>
                @if (!string.IsNullOrEmpty(Model.SupportingOrganisationHeadteacher?.Name))
                {
                    <partial name="_ContactCard"
                             model="@Model.SupportingOrganisationHeadteacher"/>  
                }
                @if (!string.IsNullOrEmpty(Model.SupportingOrganisationAccountingOfficer?.Name))
                {
                    <partial name="_ContactCard"
                             model="@Model.SupportingOrganisationAccountingOfficer"/>
                }
                @if (Model.OtherSupportingOrganisationContacts?.Any() == true)
                {
                    foreach (var contact in Model.OtherSupportingOrganisationContacts)
                    {
                        <partial name="_ContactCard"
                                 model='@contact'/>
                    }
                }
            </div>
        }
        
        @if (Model.GovernanceContactsTrust.Any()
             || Model.GovernanceContactsDiocese.Any()
             || Model.GovernanceContactsFoundation.Any()
             || Model.GovernanceContactsFederation.Any()
             || Model.GovernanceContactsLocalAuthority.Any()
             || Model.GovernanceContactsOther.Any()
        )
        {
            <div class="govuk-grid-column-three-quarters">
                <h3 class="govuk-heading-m">Governance bodies contacts</h3>
                @if (Model.GovernanceContactsTrust.Any())
                {
                    <h3 class="govuk-heading-m">@GovernanceBodyTypes.Trust.GetDisplayName()</h3>
                    @foreach (var contact in Model.GovernanceContactsTrust)
                    {
                        <partial name="_ContactCard" model="@contact"/>
                    }
                }
                @if (Model.GovernanceContactsLocalAuthority.Any())
                {
                    <h3 class="govuk-heading-m">@GovernanceBodyTypes.LocalAuthority.GetDisplayName()</h3>
                    @foreach (var contact in Model.GovernanceContactsLocalAuthority)
                    {
                        <partial name="_ContactCard" model="@contact"/>
                    }
                }
                @if (Model.GovernanceContactsDiocese.Any())
                {
                    <h3 class="govuk-heading-m">@GovernanceBodyTypes.Diocese.GetDisplayName()</h3>
                    @foreach (var contact in Model.GovernanceContactsDiocese)
                    {
                        <partial name="_ContactCard" model="@contact"/>
                    }
                }
                @if (Model.GovernanceContactsFoundation.Any())
                {
                    <h3 class="govuk-heading-m">@GovernanceBodyTypes.Foundation.GetDisplayName()</h3>
                    @foreach (var contact in Model.GovernanceContactsFoundation)
                    {
                        <partial name="_ContactCard" model="@contact"/>
                    }
                }
                @if (Model.GovernanceContactsFederation.Any())
                {
                    <h3 class="govuk-heading-m">@GovernanceBodyTypes.Federation.GetDisplayName()</h3>
                    @foreach (var contact in Model.GovernanceContactsFederation)
                    {
                        <partial name="_ContactCard" model="@contact"/>
                    }
                }
                @if (Model.GovernanceContactsOther.Any())
                {
                    <h3 class="govuk-heading-m">@GovernanceBodyTypes.Other.GetDisplayName()</h3>
                    @foreach (var contact in Model.GovernanceContactsOther)
                    {
                        <partial name="_ContactCard" model="@contact"/>
                    }
                }
            </div>
        }
        
        @if (Model.OtherContacts.Any())
        {
            <div class="govuk-grid-column-three-quarters">
                <h3 class="govuk-heading-m">Contacts without an organisation</h3>
                <p>Change these contacts' details to add the organisation they work for.</p>
                <p>They will then be grouped on this page according to their organisation type.</p>
                @foreach (var contact in Model.OtherContacts)
                {
                    <partial name="_ContactCard" model="@contact"/>
                }
            </div>
        }
    </div>
</div>

