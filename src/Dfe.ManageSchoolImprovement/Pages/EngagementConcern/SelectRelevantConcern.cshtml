@page "/engagement-concern/select-relevant-concern/{id:int}"
@using Dfe.Academisation.ExtensionMethods

@model Dfe.ManageSchoolImprovement.Frontend.Pages.EngagementConcern.SelectRelevantConcernModel

@{
    ViewData["Title"] = "Select the relevant concern";
}

@section BeforeMain
{
    <a asp-page="@Model.ReturnPage" asp-route-id="@Model.SupportProject.Id" class="govuk-back-link">Back</a>
}

@if (Model.ShowError)
{
    <partial name="_ErrorSummary" />
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <span class="govuk-caption-l">@(Model.IsInformationPowers ? "Information powers" : "Interim executive board")</span>
        <form method="post">
            @if ((Model.ActiveEngagementConcernsWithIeb && !Model.IsInformationPowers) || (Model.ActiveEngagementConcernsWithInformationPowers && Model.IsInformationPowers))
            {
                <h1 class="govuk-heading-l">Select the relevant concern</h1>
                <p class="govuk-body">There are no concerns available to assign the @(Model.IsInformationPowers ? "use of information powers" : "use of interim executive board") to. Only one active concern can have this at any one time. </p>
                <a asp-page="@Model.ReturnPage" asp-route-id="@Model.SupportProject.Id" class="govuk-button">Return</a>

            }
            else
            {
                <div class="govuk-form-group @(Model.ShowConcernSelectionError ? "govuk-form-group--error" : "")">
                    <fieldset class="govuk-fieldset">
                        <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
                            <h1 class="govuk-fieldset__heading">Select the relevant concern</h1>
                        </legend>

                        @if (Model.ShowConcernSelectionError)
                        {
                            <p id="concern-selection-error" class="govuk-error-message">
                                <span class="govuk-visually-hidden">Error:</span> Select which concern the @(Model.IsInformationPowers ? "Information powers" : "Interim executive board") is related to
                            </p>
                        }

                        <div class="govuk-radios" data-module="govuk-radios">
                            @if (Model.AvailableConcerns != null && Model.AvailableConcerns.Any())
                            {
                                @for (int i = 0; i < Model.AvailableConcerns.Count; i++)
                                {
                                    var concern = Model.AvailableConcerns[i];
                                    <div class="govuk-radios__item">
                                        <input class="govuk-radios__input"
                                               id="SelectedConcernId-@i"
                                               name="SelectedConcernId"
                                               type="radio"
                                               value="@concern.ReadableId"
                                               @(Model.SelectedConcernId == concern.ReadableId ? "checked" : "")
                                               data-cy="concern-radio-@i" />
                                        <label class="govuk-label govuk-radios__label" for="SelectedConcernId-@i">
                                            @concern.EngagementConcernSummary<br />
                                            <span class="govuk-hint">Recorded on @concern.EngagementConcernRaisedDate.ToDateString()</span>
                                        </label>
                                    </div>
                                }
                            }
                        </div>
                    </fieldset>
                </div>

                <div class="govuk-button-group govuk-body">
                    <button type="submit" draggable="false" class="govuk-button govuk-button" data-module="govuk-button" data-cy="save-and-continue-btn">
                        Save and continue
                    </button>
                    <a asp-page="@Model.ReturnPage" asp-route-id="@Model.SupportProject.Id" class="govuk-link">Cancel</a>
                </div>
            }
        </form>
    </div>
</div>
